<!DOCTYPE html>
<html>
<head>
  <title>Latin-English Paragraph Viewer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    h1 {
      text-align: center;
    }

.container {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 20px;
}

.latin {
  font-weight: bold;
  margin-bottom: 10px;
}

.english {
  margin-top: 10px;
}

    .buttons {
      display: flex;
      justify-content: center;
    }

    button {
      margin: 10px;
    }
  </style>
</head>
<body>
  <h1>Epistulae morales ad Lucilium</h1>
    <div class="buttons">
    <button onclick="previousParagraph()">Previous</button>
    <button onclick="nextParagraph()">Next</button>
      <button onclick="randomParagraph()">Random</button>
  </div>

  <div id="container"></div>

  <script>
    var currentParagraph = 0;
    var paragraphData = [];

    // Fetch JSON data from the URL
    fetch('https://raw.githubusercontent.com/danelh/danelh.github.io/master/seneca_combined.json')
      .then(response => response.json())
      .then(data => {
        paragraphData = data;
		init();
        //displayParagraph(currentParagraph);
      });

	function init(){

		init_url_change();
		fire_from_url();

		//displayParagraph(currentParagraph);
	}

	function fire_from_url(){
		load_params_from_url();
		displayParagraph(currentParagraph);
	}

	function init_url_change(){
		window.addEventListener('popstate', function(){
			user_clicked_browser = true
			fire_from_url();
			//go_to_top_of_page();
		})
	}

	function update_url_params(){
		var url_string = window.location.href
		var url = new URL(url_string);
		url.searchParams.set("p", currentParagraph);
		//if (!user_clicked_browser)
		//{
		//	// replaceState if only algo has changed. we don't want to fill the history. we want efficient back
		//	// also, you can toggle with arrows the algo.
			url_p = get_param_from_url("p");
			if (url_p != currentParagraph){
				window.history.pushState('updated params', '', url.toString());
			}
		//	else{
		//		window.history.replaceState('updated params', '', url.toString());
		//	}
		//}
		//else{
		//	// init here - because async
		//	user_clicked_browser = false
		//}
    }

	function isInteger(value) {
		return /^\d+$/.test(value);
	}

	function load_para_from_url(){
		p = get_param_from_url("p");
		if (p){
			//document.getElementById("lemmas_select").value = lemma;
			if (!isInteger(p)){
				p = 0;
			}
			currentParagraph = p;
			if ((currentParagraph < 0) || (currentParagraph >= paragraphData.length)){
				currentParagraph = paragraphData.length - 1;
			}

		}
	}

	function load_params_from_url(){
		load_para_from_url();
	}

	function get_param_from_url(param){
		var url_string = window.location.href
		var url = new URL(url_string);
		var c = url.searchParams.get(param);
		return c;
    }

    function displayParagraph(index) {
      var container = document.getElementById('container');
      container.innerHTML = '';

      var latinText = paragraphData[index].lat;
      var englishText = paragraphData[index].eng;

      var latinDiv = document.createElement('div');
      latinDiv.className = 'latin';
      latinDiv.textContent = latinText;

      var englishDiv = document.createElement('div');
      englishDiv.className = 'english';
      englishDiv.textContent = englishText;

      container.appendChild(latinDiv);
      container.appendChild(englishDiv);

	  update_url_params();
    }

    function nextParagraph() {
      currentParagraph++;
      if (currentParagraph >= paragraphData.length) {
        currentParagraph = 0;
      }
      displayParagraph(currentParagraph);
    }

    function previousParagraph() {
      currentParagraph--;
      if (currentParagraph < 0) {
        currentParagraph = paragraphData.length - 1;
      }
      displayParagraph(currentParagraph);
    }
    function randomParagraph() {
      currentParagraph = Math.floor(Math.random() * paragraphData.length);
      if (currentParagraph < 0) {
        currentParagraph = paragraphData.length - 1;
      }
      displayParagraph(currentParagraph);
    }

  </script>
</body>
</html>
